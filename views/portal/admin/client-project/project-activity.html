<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Project Activity - FG Digital</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="dist/css/ionicons.min.css">
    <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <!-- pace-progress -->
    <link rel="stylesheet" href="plugins/pace-progress/themes/green/pace-theme-minimal.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="dist/css/ekko-lightbox.css">
    <style>
        .middle {
            transition: .5s ease;
            opacity: 0;
            position: absolute;
            top: 42%;
            left: 50%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            text-align: center;
            font-size: 50px;
        }
        
        .img_container:hover .image {
            opacity: 0.3;
            cursor: pointer;
        }
        
        .img_container:hover .middle {
            opacity: 1;
            cursor: pointer;
        }
        
        .plus {
            position: absolute;
            top: 56%;
            left: 50%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            text-align: center;
            font-size: 60px;
        }
    </style>
</head>

<body class="hold-transition sidebar-mini sidebar-collapse">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="javascript:void(0);" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>
            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <li><i class="fa fa-sign-out-alt mt-1 mr-2" title="Logout" onclick="logout()" style="cursor: pointer"></i></li>
            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-success elevation-4">
            <!-- Brand Logo -->
            <a href="/admin" class="brand-link">
                <img src="images/logo-small.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">FG Digital</span>
            </a>
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="images/logo-small.png" id="img_profileImage" class="img-circle elevation-2" alt="User Image" onerror="this.src='images/logo-small.png'">
                    </div>
                    <div class="info">
                        <a href="/admin/profile" id="lbl_profileName" class="d-block">Admin Profile</a>
                    </div>
                </div>
                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
                        <li class="nav-item">
                            <a href="/admin" class="nav-link"><i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>Dashboard</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/plan" class="nav-link"><i class="nav-icon fas fa-tags"></i>
                                <p>Plans</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/client" class="nav-link"><i class="nav-icon fas fa-user-friends"></i>
                                <p>Client</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/employee" class="nav-link"><i class="nav-icon fas fa-users"></i>
                                <p>Team</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/services" class="nav-link"><i class="nav-icon fas fa-cogs"></i>
                                <p>Services</p>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>Project Activity</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="/admin">Home</a></li>
                                <li class="breadcrumb-item"><a id="lbl_navClient" href="">{Client Name}</a></li>
                                <li class="breadcrumb-item"><a id="lbl_navProjectId" href="">{project ID}</a></li>
                                <li class="breadcrumb-item"><a href="javascript:void(0);">Activity</a></li>
                                <li class="breadcrumb-item active"></li>
                            </ol>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->
            </section>
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">

                    <!-- Timelime example  -->
                    <div class="row">
                        <div class="col-md-12">
                            <!-- The time line -->
                            <div class="timeline">
                                <div id="div_activity" style="display: none;"></div>
                                <div class="time-label">
                                    <span class="bg-red">10 Feb. 2014</span>
                                </div>
                                <div>
                                    <i class="fas fa-envelope bg-blue"></i>
                                    <div class="timeline-item">
                                        <span class="time"><i class="fas fa-clock"></i> 12:05</span>
                                        <h3 class="timeline-header"><a href="#">Support Team</a> sent you an email</h3>

                                        <div class="timeline-body">
                                            Etsy doostang zoodles disqus groupon greplin oooj voxy zoodles, weebly ning heekya handango imeem plugg dopplr jibjab, movity jajah plickers sifteo edmodo ifttt zimbra. Babblely odeo kaboodle quora plaxo ideeli hulu weebly balihoo...
                                        </div>
                                        <div class="timeline-footer">
                                            <a class="btn btn-primary btn-sm">Read more</a>
                                            <a class="btn btn-danger btn-sm">Delete</a>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <i class="fa fa-plus"></i>
                                    <div class="timeline-item">
                                        <h3 class="timeline-header">Add Activity</h3>
                                        <div class="timeline-body">
                                            <div class="row form-group">
                                                <div class="col-md-6">
                                                    <label class="col-md-1">Type</label>
                                                    <select class="col-md-8 form-control" id="list_type">
                                                    <option value="">Select Type</option>
                                                    <option value="Service">Service</option>
                                                    <option value="Activity">Activity</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="div_service" style="display: none;">
                                                <div class="row form-group" id="div_service">
                                                    <div class="col-md-6">
                                                        <label class="col-md-1" id="">Services</label>
                                                        <select class="col-md-8 form-control" id="list_service">
                                                        </select>
                                                    </div>
                                                </div>
                                                <div id="div_criteria"></div>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row form-group">
                                            <div class="col-md-3">
                                                <label class="col-md-1" id="lbl_criteria">Date</label>
                                                <div class="col-md-12">
                                                    <div class="input-group date" id="reservationdate" data-target-input="nearest">
                                                        <input type="text" class="form-control datetimepicker-input" id="txt_date" data-target="#reservationdate" placeholder="YYYY/MM/DD" />
                                                        <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                                                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col-md-6">
                                                <label class="col-md-1" id="lbl_criteria">Title</label>
                                                <div class="col-md-10">
                                                    <input type="text" class="form-control" id="txt_title" placeholder="Enter Title">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col-md-6">
                                                <label class="col-md-1" id="lbl_criteria">Description</label>
                                                <div class="col-md-10">
                                                    <textarea type="text" class="form-control" rows="2" id="txt_description" placeholder="Description...."></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" id="div_post"></div>
                                        <div style="border: 1px solid #b1aeae; padding:15px; border-radius:5px;" class="m-2">
                                            <div class="row form-group" id="div_image">
                                            </div>
                                            <div class="row form-group" id="div_pdf">
                                                <input type="file" id="file_post" accept=".png, .jpg, .jpeg, .pdf" style="display: none;" multiple>
                                                <div class="col-md-2" onclick="$('#file_post').click()" style="height: 150px;border-radius:2%; cursor: pointer;" onmouseover="this.style.backgroundColor='#C0C0C0';this.style.color='#FFFFFF'" onmouseout="this.style.backgroundColor='#FFFFFF';this.style.color='#000000'">
                                                    <div class="plus">
                                                        <ion-icon name="add-circle-outline"></ion-icon>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col-md-12">
                                                <button class="btn btn-outline-primary float-right m-2"><i class="fas fa-plus"></i> Add</button>
                                                <button class="btn btn-outline-danger float-right m-2"><i class="fas fa-trash-alt"></i> Remove</button>
                                                <button class="btn btn-outline-info float-right m-2"><i class="fas fa-pencil-alt"></i> Update</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <div class="float-right d-sm-block">
            <p id="lbl_ui_version"> VERSION INFO </p>
        </div>
        <strong>Copyright &copy <script>
                document.write(new Date().getFullYear());
                </script> <a href="https://fgdigitals.com/"> FG Digital.</a></strong>
    </footer>
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables -->
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <!-- InputMask -->
    <script src="plugins/moment/moment.min.js"></script>
    <!-- Tempusdominus Bootstrap 4 -->
    <script src="plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/adminlte.min.js"></script>
    <!-- pace-progress -->
    <script src="plugins/pace-progress/pace.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <!-- sweetalert -->
    <script src="dist/js/sweetalert2.js"></script>
    <!-- toaster -->
    <script src="plugins/toastr/toastr.min.js"></script>
    <!-- lightBox -->
    <script src="dist/js/ekko-lightbox.min.js"></script>
    <!-- ionicon -->
    <script src="https://unpkg.com/ionicons@5.1.2/dist/ionicons.js"></script>
    <!-- Custom JS -->
    <script src="dist/js/logout.js"></script>
    <script src="dist/js/profile.js"></script>
    <script src="dist/js/client-project.js"></script>
</body>
<script>
    $('#reservationdate').datetimepicker({
        format: 'Y/MM/D'
    });
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).ekkoLightbox();
    });

    const urlParams = new URLSearchParams(window.location.search);
    plan_id = urlParams.get('plan_id')
    if (urlParams.has('plan_id')) {
        if (plan_id == '') {
            window.location.href = `/admin/client/project?client_id=${urlParams.get('client_id')}`
        }
        getactivity(plan_id)
    }

    function getactivity(plan_id) {
        $.get(`/admin/v1/project/fetch/${plan_id}?scope=%20activity`, (data) => {
            var projectData = data.data;
            activityData = projectData.activity;
            if (activityData) {
                $('#div_activity').show();
                for (var i = 0; i < activityData.length; i++) {
                    tempActivity = activityData[i];
                    if (tempActivity.type == 'SERVICE') {
                        var dateData = tempActivity.date;
                        var dateData = new Date(dateData),
                            d = dateData.getDate(),
                            m = dateData.getMonth() + 1,
                            y = dateData.getFullYear();
                        var serviceHtml = `<div class="time-label">
                                    <span class="bg-green">${y + "/" + m + "/" + d}</span>
                                </div>`;
                        $('#div_activity').append(serviceHtml)
                    }
                    if (tempActivity.type == 'ACTIVITY') {
                        var activityHtml = ``;
                    }
                }
            }
        });
    }

    $('#list_type').change(() => {
        if ($('#list_type').val() == 'Service') {
            $('#div_service').show();
            $.get('/admin/v1/service/get', (data) => {
                serviceData = data.data
                if (serviceData) {
                    var option = `<option value="">Select Service<option>`
                    for (var i = 0; i < serviceData.length; i++) {
                        tempService = serviceData[i];
                        option += `<option value="${tempService.service_id}">${tempService.title}<option>`
                    }
                }
                $('#list_service').html(option)
            }).fail(error => {
                error = error.responseJSON
                $(document).Toasts('create', {
                    title: 'Error!',
                    autohide: true,
                    delay: 5000,
                    body: 'Service Not Found',
                    class: 'bg-danger',
                });
            });
        } else {
            $('#div_service').hide();
            $('#list_service').val('');
            $('#div_criteria').empty();
        }
    });

    $('#list_service').change(() => {
        $('#div_criteria').empty();
        $.get(`/admin/v1/service/get?service_id=` + $('#list_service').val(), (data) => {
            var data = data.data;
            var criteriaData = data.criteria;
            var criteria = '';
            if (criteriaData) {
                for (var i = 0; i < criteriaData.length; i++) {
                    var tempCriteria = criteriaData[i];
                    criteria += `<div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group row">
                                            <label id="" class="ml-3">${tempCriteria.criteria}</label>
                                            <div class="col-md-1">
                                                <input type="text" id="txt_criteria_${tempCriteria.criteria_id}" class="form-control" id="" placeholder="Value">
                                            </div>
                                        </div>
                                    </div>
                                </div>`
                }
            }
            $('#div_criteria').append(criteria)
        }).fail(error => {
            error = error.responseJSON
            $(document).Toasts('create', {
                title: 'Error!',
                autohide: true,
                delay: 5000,
                body: 'Criteria Not Found',
                class: 'bg-danger',
            });
        });
    });
    $("#file_post").change(function() {
        var files = [];
        for (var i = 0; i < $(this).get(0).files.length; ++i) {
            files.push($(this).get(0).files[i]);
            var type = files[i].type.split('/').pop().toLowerCase();
            if (type != "jpeg" && type != "jpg" && type != "png" && type != "pdf") {
                return $(document).Toasts('create', {
                    title: 'File Formate not Correct ',
                    autohide: true,
                    delay: 5000,
                    body: 'Select valid File Formate',
                    class: 'bg-danger',
                });
            }
            if (files[i].size / 1024 / 1024 > 15) {
                return $(document).Toasts('create', {
                    title: 'File is too Large',
                    autohide: true,
                    delay: 5000,
                    body: 'please select file size below 10 MB',
                    class: 'bg-danger',
                });
            }
            const objectURL = URL.createObjectURL(files[i])
            if (type == "pdf") {
                pdf = `<div class="col-md-2">
                        <div>
                            <iframe src="${objectURL}" width="100%" height="150px"></iframe>
                            <div class="middle">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="row" style="display:none;">
                            <a class="col-md-6 btn btn-outline-success btn-block mt-1 btn-sm mb-1" href="${objectURL}" download="${objectURL}"><i class="fa fa-download" aria-hidden="true"></i> Download</a>
                            <button class="btn btn-outline-danger btn-block mb-1 mt-1 btn-sm col-md-6"><i class="fas fa-trash-alt"></i> Remove</button>
                        </div>
                    </div>`;
                $('#div_pdf').prepend(pdf);
            } else {
                image = `<div class="col-md-2 img_container form-group">
                        <div class='' href='${objectURL}' data-toggle="lightbox">
                            <img src="${objectURL}" id='img_post' class="image" style="height: 150px; width: 100%">
                            <div class="middle">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                    </div>`;
                $("#div_pdf").prepend(image);
            }
        }
    });
</script>

</html>